From 798a42ad36adbc4204945b9f6360b710b8f8f597 Mon Sep 17 00:00:00 2001
From: Vladimir Oltean <vladimir.oltean@nxp.com>
Date: Thu, 21 Nov 2019 12:01:03 +0200
Subject: [PATCH buildroot 17/18] net: dsa: sja1105: Sleep while polling for
 mgmt xmit completion

Signed-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>
---
 drivers/net/dsa/sja1105/sja1105_main.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/net/dsa/sja1105/sja1105_main.c b/drivers/net/dsa/sja1105/sja1105_main.c
index e50700073554..2cf32c22e839 100644
--- a/drivers/net/dsa/sja1105/sja1105_main.c
+++ b/drivers/net/dsa/sja1105/sja1105_main.c
@@ -1901,8 +1901,10 @@ static int sja1105_mgmt_xmit(struct dsa_switch *ds, int port, int slot,
 		 * cleared when a match is found. The host can use this
 		 * flag as an acknowledgment.
 		 */
-		cpu_relax();
-	} while (mgmt_route.enfport && --timeout);
+		if (!mgmt_route.enfport)
+			break;
+		usleep_range(100, 500);
+	} while (--timeout);
 
 	if (!timeout) {
 		/* Clean up the management route so that a follow-up
-- 
2.17.1

